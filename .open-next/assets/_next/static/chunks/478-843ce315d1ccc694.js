"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[478],{1272:(t,e,i)=>{var s=i(9769),r=i(3016),a="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},n=r.useSyncExternalStore,o=s.useRef,l=s.useEffect,u=s.useMemo,d=s.useDebugValue;e.useSyncExternalStoreWithSelector=function(t,e,i,s,r){var h=o(null);if(null===h.current){var c={hasValue:!1,value:null};h.current=c}else c=h.current;var f=n(t,(h=u(function(){function t(t){if(!l){if(l=!0,n=t,t=s(t),void 0!==r&&c.hasValue){var e=c.value;if(r(e,t))return o=e}return o=t}if(e=o,a(n,t))return e;var i=s(t);return void 0!==r&&r(e,i)?(n=t,e):(n=t,o=i)}var n,o,l=!1,u=void 0===i?null:i;return[function(){return t(e())},null===u?void 0:function(){return t(u())}]},[e,i,s,r]))[0],h[1]);return l(function(){c.hasValue=!0,c.value=f},[f]),d(f),f}},2446:(t,e,i)=>{t.exports=i(1272)},3016:(t,e,i)=>{t.exports=i(3423)},3423:(t,e,i)=>{var s=i(9769),r="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},a=s.useState,n=s.useEffect,o=s.useLayoutEffect,l=s.useDebugValue;function u(t){var e=t.getSnapshot;t=t.value;try{var i=e();return!r(t,i)}catch(t){return!0}}var d="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(t,e){return e()}:function(t,e){var i=e(),s=a({inst:{value:i,getSnapshot:e}}),r=s[0].inst,d=s[1];return o(function(){r.value=i,r.getSnapshot=e,u(r)&&d({inst:r})},[t,i,e]),n(function(){return u(r)&&d({inst:r}),t(function(){u(r)&&d({inst:r})})},[t]),l(i),i};e.useSyncExternalStore=void 0!==s.useSyncExternalStore?s.useSyncExternalStore:d},8097:(t,e,i)=>{let s;i.d(e,{m:()=>tc});var r=i(4237);function a(t,e){return"function"==typeof t?t(e):t}function n(t,e){return m(e).reduce((t,e)=>null===t?null:void 0!==t?t[e]:void 0,t)}function o(t,e,i){let s=m(e);return function t(e){if(!s.length)return a(i,e);let r=s.shift();if("string"==typeof r||"number"==typeof r&&!Array.isArray(e))return"object"==typeof e?(null===e&&(e={}),{...e,[r]:t(e[r])}):{[r]:t()};if(Array.isArray(e)&&"number"==typeof r){let i=e.slice(0,r);return[...i.length?i:Array(r),t(e[r]),...e.slice(r+1)]}return[...Array(r),t()]}(t)}let l=/^(\d+)$/gm,u=/\.(\d+)(?=\.)/gm,d=/^(\d+)\./gm,h=/\.(\d+$)/gm,c=/\.{2,}/gm,f="__int__",v=`${f}$1`;function m(t){if(Array.isArray(t))return[...t];if("string"!=typeof t)throw Error("Path must be a string.");return t.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(l,v).replace(u,`.${v}.`).replace(d,`${v}.`).replace(h,`.${v}`).replace(c,".").split(".").map(t=>{if(t.startsWith(f)){let e=t.substring(f.length),i=parseInt(e,10);return String(i)===e?i:e}return t})}function p(t,e){return e.validationLogic({form:e.form,validators:e.validators,event:{type:t,async:!1},runValidation:t=>t.validators.filter(Boolean).map(t=>({cause:t.cause,validate:t.fn}))})}function g(t,e){let{asyncDebounceMs:i}=e,{onBlurAsyncDebounceMs:s,onChangeAsyncDebounceMs:r,onDynamicAsyncDebounceMs:a}=e.validators||{},n=i??0;return e.validationLogic({form:e.form,validators:e.validators,event:{type:t,async:!0},runValidation:e=>e.validators.filter(Boolean).map(e=>{let i=e?.cause||t,o=n;switch(i){case"change":o=r??n;break;case"blur":o=s??n;break;case"dynamic":o=a??n;break;case"submit":o=0}return"submit"===t&&(o=0),{cause:i,validate:e.fn,debounceMs:o}})})}let b=t=>!!t&&"object"==typeof t&&"fields"in t;function y(t,e){if(Object.is(t,e))return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(let[i,s]of t)if(!e.has(i)||!Object.is(s,e.get(i)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(let i of t)if(!e.has(i))return!1;return!0}let i=Object.keys(t),s=Object.keys(e);if(i.length!==s.length)return!1;for(let r of i)if(!s.includes(r)||!y(t[r],e[r]))return!1;return!0}let S=({newFormValidatorError:t,isPreviousErrorFromFormValidator:e,previousErrorValue:i})=>t?{newErrorValue:t,newSource:"form"}:e?{newErrorValue:void 0,newSource:void 0}:i?{newErrorValue:i,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},M=({formLevelError:t,fieldLevelError:e})=>e?{newErrorValue:e,newSource:"field"}:t?{newErrorValue:t,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function V(t,e){return null==t?e:{...t,...e}}let E=256,A=[];for(;E--;)A[E]=(E+256).toString(16).substring(1);class F{constructor(t,e){this.listeners=new Set,this.subscribe=t=>{var e,i;this.listeners.add(t);let s=null==(i=null==(e=this.options)?void 0:e.onSubscribe)?void 0:i.call(e,t,this);return()=>{this.listeners.delete(t),null==s||s()}},this.prevState=t,this.state=t,this.options=e}setState(t){var e,i,s;(this.prevState=this.state,null==(e=this.options)?void 0:e.updateFn)?this.state=this.options.updateFn(this.prevState)(t):"function"==typeof t?this.state=t(this.prevState):this.state=t,null==(s=null==(i=this.options)?void 0:i.onUpdate)||s.call(i),D(this)}}class w{constructor(t){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{let t=this.options.deps.length,e=Array(t),i=Array(t);for(let s=0;s<t;s++){let t=this.options.deps[s];e[s]=t.prevState,i[s]=t.state}return this.lastSeenDepValues=i,{prevDepVals:e,currDepVals:i,prevVal:this.prevState??void 0}},this.recompute=()=>{var t,e;this.prevState=this.state;let i=this.getDepVals();this.state=this.options.fn(i),null==(e=(t=this.options).onUpdate)||e.call(t)},this.checkIfRecalculationNeededDeeply=()=>{for(let t of this.options.deps)t instanceof w&&t.checkIfRecalculationNeededDeeply();let t=!1,e=this.lastSeenDepValues,{currDepVals:i}=this.getDepVals();for(let s=0;s<i.length;s++)if(i[s]!==e[s]){t=!0;break}t&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{for(let t of(this.unregisterFromGraph(),this._subscriptions))t()}),this.subscribe=t=>{var e,i;this.listeners.add(t);let s=null==(i=(e=this.options).onSubscribe)?void 0:i.call(e,t,this);return()=>{this.listeners.delete(t),null==s||s()}},this.options=t,this.state=t.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(t=this.options.deps){for(let e of t)if(e instanceof w)e.registerOnGraph(),this.registerOnGraph(e.options.deps);else if(e instanceof F){let t=I.get(e);t||(t=new Set,I.set(e,t)),t.add(this);let i=L.get(this);i||(i=new Set,L.set(this,i)),i.add(e)}}unregisterFromGraph(t=this.options.deps){for(let e of t)if(e instanceof w)this.unregisterFromGraph(e.options.deps);else if(e instanceof F){let t=I.get(e);t&&t.delete(this);let i=L.get(this);i&&i.delete(e)}}}let I=new WeakMap,L=new WeakMap,T={current:[]},O=!1,C=0,k=new Set,j=new Map;function D(t){if((C>0&&!j.has(t)&&j.set(t,t.prevState),k.add(t),!(C>0))&&!O)try{for(O=!0;k.size>0;){let t=Array.from(k);for(let e of(k.clear(),t)){let t=j.get(e)??e.prevState;e.prevState=t;let i={prevVal:e.prevState,currentVal:e.state};for(let t of e.listeners)t(i)}for(let e of t){let t=I.get(e);t&&(T.current.push(e),function t(e){for(let i of Array.from(e).sort((t,e)=>t instanceof w&&t.options.deps.includes(e)?1:e instanceof w&&e.options.deps.includes(t)?-1:0)){if(T.current.includes(i))continue;T.current.push(i),i.recompute();let e=L.get(i);if(e)for(let i of e){let e=I.get(i);e&&t(e)}}}(t))}for(let e of t){let t=I.get(e);if(t)for(let e of t){let t={prevVal:e.prevState,currentVal:e.state};for(let i of e.listeners)i(t)}}}}finally{O=!1,T.current=[],j.clear()}}function _(t){C++;try{t()}finally{if(0==--C){let t=k.values().next().value;t&&D(t)}}}function x(t,...e){return"function"==typeof t?t(...e):t}class B{#t=!0;#e;#i;#s;#r;#a;#n;#o;#l=0;#u=5;#d=!1;#h=()=>{this.debugLog("Connected to event bus"),this.#a=!0,this.#d=!1,this.debugLog("Emitting queued events",this.#r),this.#r.forEach(t=>this.emitEventToBus(t)),this.#r=[],this.stopConnectLoop(),this.#i().removeEventListener("tanstack-connect-success",this.#h)};#c=()=>{if(this.#l<this.#u){this.#l++,this.dispatchCustomEvent("tanstack-connect",{});return}this.#i().removeEventListener("tanstack-connect",this.#c),this.debugLog("Max retries reached, giving up on connection"),this.stopConnectLoop()};#f=()=>{this.#d||(this.#d=!0,this.#i().addEventListener("tanstack-connect-success",this.#h),this.#c())};constructor({pluginId:t,debug:e=!1,enabled:i=!0,reconnectEveryMs:s=300}){this.#e=t,this.#t=i,this.#i=this.getGlobalTarget,this.#s=e,this.debugLog(" Initializing event subscription for plugin",this.#e),this.#r=[],this.#a=!1,this.#n=null,this.#o=s}startConnectLoop(){null!==this.#n||this.#a||(this.debugLog(`Starting connect loop (every ${this.#o}ms)`),this.#n=setInterval(this.#c,this.#o))}stopConnectLoop(){this.#d=!1,null!==this.#n&&(clearInterval(this.#n),this.#n=null,this.debugLog("Stopped connect loop"))}debugLog(...t){this.#s&&console.log(`ðŸŒ´ [tanstack-devtools:${this.#e}-plugin]`,...t)}getGlobalTarget(){if("undefined"!=typeof globalThis&&globalThis.__TANSTACK_EVENT_TARGET__)return this.debugLog("Using global event target"),globalThis.__TANSTACK_EVENT_TARGET__;if("undefined"!=typeof window&&void 0!==window.addEventListener)return this.debugLog("Using window as event target"),window;let t="undefined"!=typeof EventTarget?new EventTarget:void 0;return void 0===t||void 0===t.addEventListener?(this.debugLog("No event mechanism available, running in non-web environment"),{addEventListener:()=>{},removeEventListener:()=>{},dispatchEvent:()=>!1}):(this.debugLog("Using new EventTarget as fallback"),t)}getPluginId(){return this.#e}dispatchCustomEventShim(t,e){try{let i=new Event(t,{detail:e});this.#i().dispatchEvent(i)}catch(t){this.debugLog("Failed to dispatch shim event")}}dispatchCustomEvent(t,e){try{this.#i().dispatchEvent(new CustomEvent(t,{detail:e}))}catch(i){this.dispatchCustomEventShim(t,e)}}emitEventToBus(t){this.debugLog("Emitting event to client bus",t),this.dispatchCustomEvent("tanstack-dispatch-event",t)}emit(t,e){if(!this.#t)return void this.debugLog("Event bus client is disabled, not emitting event",t,e);if(!this.#a){this.debugLog("Bus not available, will be pushed as soon as connected"),this.#r.push({type:`${this.#e}:${t}`,payload:e,pluginId:this.#e}),"undefined"==typeof CustomEvent||this.#d||(this.#f(),this.startConnectLoop());return}return this.emitEventToBus({type:`${this.#e}:${t}`,payload:e,pluginId:this.#e})}on(t,e){let i=`${this.#e}:${t}`;if(!this.#t)return this.debugLog("Event bus client is disabled, not registering event",i),()=>{};let s=t=>{this.debugLog("Received event from bus",t.detail),e(t.detail)};return this.#i().addEventListener(i,s),this.debugLog("Registered event to bus",i),()=>{this.#i().removeEventListener(i,s)}}onAll(t){if(!this.#t)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};let e=e=>{t(e.detail)};return this.#i().addEventListener("tanstack-devtools-global",e),()=>this.#i().removeEventListener("tanstack-devtools-global",e)}onAllPluginEvents(t){if(!this.#t)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};let e=e=>{let i=e.detail;this.#e&&i.pluginId!==this.#e||t(i)};return this.#i().addEventListener("tanstack-devtools-global",e),()=>this.#i().removeEventListener("tanstack-devtools-global",e)}}class $ extends B{constructor(t){super({pluginId:"pacer",debug:t?.debug})}}let R=new $;function P(){return{executionCount:0,isPending:!1,lastArgs:void 0,lastExecutionTime:0,nextExecutionTime:0,status:"idle",maybeExecuteCount:0}}let W={enabled:!0,leading:!0,trailing:!0,wait:0};class N{constructor(t,e){this.fn=t,this.store=new F(P()),this.setOptions=t=>{this.options={...this.options,...t},this.#v()||this.cancel()},this.#m=t=>{this.store.setState(e=>{let i={...e,...t},{isPending:s}=i;return{...i,status:this.#v()?s?"pending":"idle":"disabled"}}),R.emit("Throttler",this)},this.#v=()=>!!x(this.options.enabled,this),this.#p=()=>x(this.options.wait,this),this.maybeExecute=(...t)=>{this.#m({maybeExecuteCount:this.store.state.maybeExecuteCount+1});let e=Date.now(),i=e-this.store.state.lastExecutionTime,s=this.#p();if(this.options.leading&&i>=s)this.#g(...t);else if(this.#m({lastArgs:t}),!this.#b&&this.options.trailing){let t=this.store.state.lastExecutionTime?e-this.store.state.lastExecutionTime:0;this.#m({isPending:!0}),this.#b=setTimeout(()=>{let{lastArgs:t}=this.store.state;void 0!==t&&this.#g(...t)},s-t)}},this.#g=(...t)=>{if(!this.#v())return;this.fn(...t);let e=Date.now(),i=e+this.#p();this.#y(),this.#m({executionCount:this.store.state.executionCount+1,lastExecutionTime:e,nextExecutionTime:i,isPending:!1,lastArgs:void 0}),this.options.onExecute?.(t,this),setTimeout(()=>{this.store.state.isPending||this.#m({nextExecutionTime:void 0})},this.#p())},this.flush=()=>{this.store.state.isPending&&this.store.state.lastArgs&&this.#g(...this.store.state.lastArgs)},this.#y=()=>{this.#b&&(clearTimeout(this.#b),this.#b=void 0)},this.cancel=()=>{this.#y(),this.#m({lastArgs:void 0,isPending:!1})},this.reset=()=>{this.#m(P())},this.key=function(t){return t||("undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"")}(e.key),this.options={...W,...e},this.#m(this.options.initialState??{}),R.on("d-Throttler",t=>{t.payload.key===this.key&&(this.#m(t.payload.store.state),this.setOptions(t.payload.options))})}#b;#m;#v;#p;#g;#y}let U=t=>{if(!t.validators)return t.runValidation({validators:[],form:t.form});let e=t.event.async,i=e?void 0:{fn:t.validators.onMount,cause:"mount"},s={fn:e?t.validators.onChangeAsync:t.validators.onChange,cause:"change"},r={fn:e?t.validators.onBlurAsync:t.validators.onBlur,cause:"blur"},a={fn:e?t.validators.onSubmitAsync:t.validators.onSubmit,cause:"submit"},n=e?void 0:{fn:()=>void 0,cause:"server"};switch(t.event.type){case"mount":return t.runValidation({validators:[i],form:t.form});case"submit":return t.runValidation({validators:[s,r,a,n],form:t.form});case"server":return t.runValidation({validators:[],form:t.form});case"blur":return t.runValidation({validators:[r,n],form:t.form});case"change":return t.runValidation({validators:[s,n],form:t.form});default:throw Error(`Unknown validation event type: ${t.event.type}`)}},G=(t,e)=>{let i=function(t,e){let i=new Map;for(let s of t){let t=s.path??[],r=e,a="";for(let e=0;e<t.length;e++){let i=t[e];if(void 0===i)continue;let s="object"==typeof i?i.key:i,n=Number(s);Array.isArray(r)&&!Number.isNaN(n)?a+=`[${n}]`:a+=(e>0?".":"")+String(s),r="object"==typeof r&&null!==r?r[s]:void 0}i.set(a,(i.get(a)??[]).concat(s))}return Object.fromEntries(i)}(t,e);return{form:i,fields:i}},q={validate({value:t,validationSource:e},i){let s=i["~standard"].validate(t);if(s instanceof Promise)throw Error("async function passed to sync validator");if(s.issues)return"field"===e?s.issues:G(s.issues,t)},async validateAsync({value:t,validationSource:e},i){let s=await i["~standard"].validate(t);if(s.issues)return"field"===e?s.issues:G(s.issues,t)}},z=t=>!!t&&"~standard"in t,K={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function H(t){function e(t,e){return`${t}[${e}]`}function i(i,s,r,a){let n=[e(i,s)];switch(r){case"swap":n.push(e(i,a));break;case"move":{let[t,r]=[Math.min(s,a),Math.max(s,a)];for(let s=t;s<=r;s++)n.push(e(i,s));break}default:{let r=t.getFieldValue(i),a=Array.isArray(r)?r.length:0;for(let t=s+1;t<a;t++)n.push(e(i,t))}}return Object.keys(t.fieldInfo).filter(t=>n.some(e=>t.startsWith(e)))}function s(e,i){("up"===i?e:[...e].reverse()).forEach(e=>{var s;let a=(s=e.toString(),s.replace(/\[(\d+)\]/,(t,e)=>{let s=parseInt(e,10),r="up"===i?s+1:Math.max(0,s-1);return`[${r}]`})),n=t.getFieldMeta(a);n?t.setFieldMeta(e,n):t.setFieldMeta(e,r())})}let r=()=>K;return{handleArrayMove:function(r,a,n){let o=i(r,a,"move",n),l=Math.min(a,n),u=Math.max(a,n);for(let t=l;t<=u;t++)o.push(e(r,t));let d=Object.keys(t.fieldInfo).reduce((i,s)=>(s.startsWith(e(r,a))&&i.set(s,t.getFieldMeta(s)),i),new Map);s(o,a<n?"up":"down"),Object.keys(t.fieldInfo).filter(t=>t.startsWith(e(r,n))).forEach(i=>{let s=i.replace(e(r,n),e(r,a)),o=d.get(s);o&&t.setFieldMeta(i,o)})},handleArrayRemove:function(t,e){s(i(t,e,"remove"),"up")},handleArraySwap:function(s,r,a){i(s,r,"swap",a).forEach(i=>{if(!i.toString().startsWith(e(s,r)))return;let n=i.toString().replace(e(s,r),e(s,a)),[o,l]=[t.getFieldMeta(i),t.getFieldMeta(n)];o&&t.setFieldMeta(n,o),l&&t.setFieldMeta(i,l)})},handleArrayInsert:function(a,n){let o=i(a,n,"insert");s(o,"down"),o.forEach(i=>{i.toString().startsWith(e(a,n))&&t.setFieldMeta(i,r())})}}}class J extends B{constructor(){super({pluginId:"form-devtools",reconnectEveryMs:1e3})}}let Q=new J;function X(t){return{values:t.values??{},errorMap:t.errorMap??{},fieldMetaBase:t.fieldMetaBase??{},isSubmitted:t.isSubmitted??!1,isSubmitting:t.isSubmitting??!1,isValidating:t.isValidating??!1,submissionAttempts:t.submissionAttempts??0,isSubmitSuccessful:t.isSubmitSuccessful??!1,validationMetaMap:t.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class Y{constructor(t){this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{let t=this.fieldMetaDerived.mount(),e=this.store.mount(),i=()=>{t(),e(),Q.emit("form-unmounted",{id:this._formId})};this.options.listeners?.onMount?.({formApi:this});let{onMount:s}=this.options.validators||{};return Q.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}),s&&this.validateSync("mount"),i},this.update=t=>{if(!t)return;let e=this.options;this.options=t;let i=!!t.transform?.deps?.some((t,e)=>t!==this.prevTransformArray[e]),s=t.defaultValues&&!y(t.defaultValues,e.defaultValues)&&!this.state.isTouched,r=!y(t.defaultState,e.defaultState)&&!this.state.isTouched;(s||r||i)&&(_(()=>{this.baseStore.setState(()=>X(Object.assign({},this.state,r?t.defaultState:{},s?{values:t.defaultValues}:{},i?{_force_re_eval:!this.state._force_re_eval}:{})))}),Q.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}))},this.reset=(t,e)=>{let{fieldMeta:i}=this.state,s=this.resetFieldMeta(i);t&&!e?.keepDefaultValues&&(this.options={...this.options,defaultValues:t}),this.baseStore.setState(()=>X({...this.options.defaultState,values:t??this.options.defaultValues??this.options.defaultState?.values,fieldMetaBase:s}))},this.validateAllFields=async t=>{let e=[];return _(()=>{Object.values(this.fieldInfo).forEach(i=>{if(!i.instance)return;let s=i.instance;e.push(Promise.resolve().then(()=>s.validate(t,{skipFormValidation:!0}))),i.instance.state.meta.isTouched||i.instance.setMeta(t=>({...t,isTouched:!0}))})}),(await Promise.all(e)).flat()},this.validateArrayFieldsStartingFrom=async(t,e,i)=>{let s=this.getFieldValue(t),r=Array.isArray(s)?Math.max(s.length-1,0):null,a=[`${t}[${e}]`];for(let i=e+1;i<=(r??0);i++)a.push(`${t}[${i}]`);let n=Object.keys(this.fieldInfo).filter(t=>a.some(e=>t.startsWith(e))),o=[];return _(()=>{n.forEach(t=>{o.push(Promise.resolve().then(()=>this.validateField(t,i)))})}),(await Promise.all(o)).flat()},this.validateField=(t,e)=>{let i=this.fieldInfo[t]?.instance;return i?(i.state.meta.isTouched||i.setMeta(t=>({...t,isTouched:!0})),i.validate(e)):[]},this.validateSync=t=>{let e=p(t,{...this.options,form:this,validationLogic:this.options.validationLogic||U}),i=!1,s={};return _(()=>{for(let t of e){if(!t.validate)continue;let{formError:e,fieldErrors:r}=Z(this.runValidator({validate:t.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"})),a=tt(t.cause);for(let t of Object.keys(this.state.fieldMeta)){if(void 0===this.baseStore.state.fieldMetaBase[t])continue;let e=this.getFieldMeta(t);if(!e)continue;let{errorMap:i,errorSourceMap:n}=e,o=r?.[t],{newErrorValue:l,newSource:u}=S({newFormValidatorError:o,isPreviousErrorFromFormValidator:n?.[a]==="form",previousErrorValue:i?.[a]});"form"===u&&(s[t]={...s[t],[a]:o}),i?.[a]!==l&&this.setFieldMeta(t,t=>({...t,errorMap:{...t.errorMap,[a]:l},errorSourceMap:{...t.errorSourceMap,[a]:u}}))}this.state.errorMap?.[a]!==e&&this.baseStore.setState(t=>({...t,errorMap:{...t.errorMap,[a]:e}})),(e||r)&&(i=!0)}let r=tt("submit");this.state.errorMap?.[r]&&"submit"!==t&&!i&&this.baseStore.setState(t=>({...t,errorMap:{...t.errorMap,[r]:void 0}}));let a=tt("server");this.state.errorMap?.[a]&&"server"!==t&&!i&&this.baseStore.setState(t=>({...t,errorMap:{...t.errorMap,[a]:void 0}}))}),{hasErrored:i,fieldsErrorMap:s}},this.validateAsync=async t=>{let e,i=g(t,{...this.options,form:this,validationLogic:this.options.validationLogic||U});this.state.isFormValidating||this.baseStore.setState(t=>({...t,isFormValidating:!0}));let s=[];for(let t of i){if(!t.validate)continue;let i=tt(t.cause),r=this.state.validationMetaMap[i];r?.lastAbortController.abort();let a=new AbortController;this.state.validationMetaMap[i]={lastAbortController:a},s.push(new Promise(async i=>{let s;try{s=await new Promise((e,i)=>{setTimeout(async()=>{if(a.signal.aborted)return e(void 0);try{e(await this.runValidator({validate:t.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:a.signal},type:"validateAsync"}))}catch(t){i(t)}},t.debounceMs)})}catch(t){s=t}let{formError:r,fieldErrors:n}=Z(s);n&&(e=e?{...e,...n}:n);let o=tt(t.cause);for(let t of Object.keys(this.state.fieldMeta)){if(void 0===this.baseStore.state.fieldMetaBase[t])continue;let i=this.getFieldMeta(t);if(!i)continue;let{errorMap:s,errorSourceMap:r}=i,{newErrorValue:a,newSource:n}=S({newFormValidatorError:e?.[t],isPreviousErrorFromFormValidator:r?.[o]==="form",previousErrorValue:s?.[o]});s?.[o]!==a&&this.setFieldMeta(t,t=>({...t,errorMap:{...t.errorMap,[o]:a},errorSourceMap:{...t.errorSourceMap,[o]:n}}))}this.baseStore.setState(t=>({...t,errorMap:{...t.errorMap,[o]:r}})),i(e?{fieldErrors:e,errorMapKey:o}:void 0)}))}let r={};if(s.length){for(let t of(await Promise.all(s)))if(t?.fieldErrors){let{errorMapKey:e}=t;for(let[i,s]of Object.entries(t.fieldErrors)){let t={...r[i]||{},[e]:s};r[i]=t}}}return this.baseStore.setState(t=>({...t,isFormValidating:!1})),r},this.validate=t=>{let{hasErrored:e,fieldsErrorMap:i}=this.validateSync(t);return e&&!this.options.asyncAlways?i:this.validateAsync(t)},this.getFieldValue=t=>n(this.state.values,t),this.getFieldMeta=t=>this.state.fieldMeta[t],this.getFieldInfo=t=>this.fieldInfo[t]||={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}},this.setFieldMeta=(t,e)=>{this.baseStore.setState(i=>({...i,fieldMetaBase:{...i.fieldMetaBase,[t]:a(e,i.fieldMetaBase[t])}}))},this.resetFieldMeta=t=>Object.keys(t).reduce((t,e)=>(t[e]=K,t),{}),this.setFieldValue=(t,e,i)=>{let s=i?.dontUpdateMeta??!1,r=i?.dontRunListeners??!1,a=i?.dontValidate??!1;_(()=>{s||this.setFieldMeta(t,t=>({...t,isTouched:!0,isDirty:!0,errorMap:{...t?.errorMap,onMount:void 0}})),this.baseStore.setState(i=>({...i,values:o(i.values,t,e)}))}),r||this.getFieldInfo(t).instance?.triggerOnChangeListener(),a||this.validateField(t,"change")},this.deleteField=t=>{let e=[...Object.keys(this.fieldInfo).filter(e=>{let i=t.toString();return e!==i&&e.startsWith(i)}),t];this.baseStore.setState(t=>{let i={...t};return e.forEach(t=>{i.values=function(t,e){let i=m(e);return function t(e){if(!e)return;if(1===i.length){let t=i[0];if(Array.isArray(e)&&"number"==typeof t)return e.filter((e,i)=>i!==t);let{[t]:s,...r}=e;return r}let s=i.shift();if("string"==typeof s&&"object"==typeof e)return{...e,[s]:t(e[s])};if("number"==typeof s&&Array.isArray(e)){if(s>=e.length)return e;let i=e.slice(0,s);return[...i.length?i:Array(s),t(e[s]),...e.slice(s+1)]}throw Error("It seems we have created an infinite loop in deleteBy. ")}(t)}(i.values,t),delete this.fieldInfo[t],delete i.fieldMetaBase[t]}),i})},this.pushFieldValue=(t,e,i)=>{this.setFieldValue(t,t=>[...Array.isArray(t)?t:[],e],i)},this.insertFieldValue=async(t,e,i,s)=>{this.setFieldValue(t,t=>[...t.slice(0,e),i,...t.slice(e)],V(s,{dontValidate:!0}));let r=s?.dontValidate??!1;r||await this.validateField(t,"change"),H(this).handleArrayInsert(t,e),r||await this.validateArrayFieldsStartingFrom(t,e,"change")},this.replaceFieldValue=async(t,e,i,s)=>{this.setFieldValue(t,t=>t.map((t,s)=>s===e?i:t),V(s,{dontValidate:!0})),s?.dontValidate||(await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,e,"change"))},this.removeFieldValue=async(t,e,i)=>{let s=this.getFieldValue(t),r=Array.isArray(s)?Math.max(s.length-1,0):null;if(this.setFieldValue(t,t=>t.filter((t,i)=>i!==e),V(i,{dontValidate:!0})),H(this).handleArrayRemove(t,e),null!==r){let e=`${t}[${r}]`;this.deleteField(e)}i?.dontValidate||(await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,e,"change"))},this.swapFieldValues=(t,e,i,s)=>{this.setFieldValue(t,t=>{let s=t[e],r=t[i];return o(o(t,`${e}`,r),`${i}`,s)},V(s,{dontValidate:!0})),H(this).handleArraySwap(t,e,i),s?.dontValidate||(this.validateField(t,"change"),this.validateField(`${t}[${e}]`,"change"),this.validateField(`${t}[${i}]`,"change"))},this.moveFieldValues=(t,e,i,s)=>{this.setFieldValue(t,t=>{let s=[...t];return s.splice(i,0,s.splice(e,1)[0]),s},V(s,{dontValidate:!0})),H(this).handleArrayMove(t,e,i),s?.dontValidate||(this.validateField(t,"change"),this.validateField(`${t}[${e}]`,"change"),this.validateField(`${t}[${i}]`,"change"))},this.clearFieldValues=(t,e)=>{let i=this.getFieldValue(t),s=Array.isArray(i)?Math.max(i.length-1,0):null;if(this.setFieldValue(t,[],V(e,{dontValidate:!0})),null!==s)for(let e=0;e<=s;e++){let i=`${t}[${e}]`;this.deleteField(i)}e?.dontValidate||this.validateField(t,"change")},this.resetField=t=>{this.baseStore.setState(e=>({...e,fieldMetaBase:{...e.fieldMetaBase,[t]:K},values:this.options.defaultValues?o(e.values,t,n(this.options.defaultValues,t)):e.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((t,[e,i])=>(Object.keys(i).length&&i.errors.length&&(t[e]={errors:i.errors,errorMap:i.errorMap}),t),{})}),this.parseValuesWithSchema=t=>q.validate({value:this.state.values,validationSource:"form"},t),this.parseValuesWithSchemaAsync=t=>q.validateAsync({value:this.state.values,validationSource:"form"},t),this.timeoutIds={validations:{},listeners:{},formListeners:{}},this._formId=t?.formId??function(){let t,e=0,i="";if(!s||E+16>256){for(s=Array(256),e=256;e--;)s[e]=256*Math.random()|0;e=0,E=0}for(;e<16;e++)t=s[E+e],6===e?i+=A[15&t|64]:8===e?i+=A[63&t|128]:i+=A[t],1&e&&e>1&&e<11&&(i+="-");return E++,i}(),this._devtoolsSubmissionOverride=!1,this.baseStore=new F(X({...t?.defaultState,values:t?.defaultValues??t?.defaultState?.values})),this.fieldMetaDerived=new w({deps:[this.baseStore],fn:({prevDepVals:t,currDepVals:e,prevVal:i})=>{let s=t?.[0],r=e[0],a=0,o={};for(let t of Object.keys(r.fieldMetaBase)){let e=r.fieldMetaBase[t],l=s?.fieldMetaBase[t],u=i?.[t],d=n(r.values,t),h=u?.errors;if(!l||e.errorMap!==l.errorMap){h=Object.values(e.errorMap??{}).filter(t=>void 0!==t);let i=this.getFieldInfo(t)?.instance;i&&!i.options.disableErrorFlat&&(h=h.flat(1))}let c=!function(t){return!(Array.isArray(t)&&0===t.length)}(h),f=!e.isDirty,v=y(d,n(this.options.defaultValues,t))||y(d,this.getFieldInfo(t)?.instance?.options.defaultValue);if(u&&u.isPristine===f&&u.isValid===c&&u.isDefaultValue===v&&u.errors===h&&e===l){o[t]=u,a++;continue}o[t]={...e,errors:h??[],isPristine:f,isValid:c,isDefaultValue:v}}return Object.keys(r.fieldMetaBase).length&&i&&a===Object.keys(r.fieldMetaBase).length?i:o}}),this.store=new w({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:t,currDepVals:e,prevVal:i})=>{let s=t?.[0],r=e[0],a=Object.values(e[1]).filter(Boolean),n=a.some(t=>t.isValidating),o=a.every(t=>t.isValid),l=a.some(t=>t.isTouched),u=a.some(t=>t.isBlurred),d=a.every(t=>t.isDefaultValue),h=l&&r.errorMap?.onMount,c=a.some(t=>t.isDirty),f=!c,v=!!(r.errorMap?.onMount||a.some(t=>t?.errorMap?.onMount)),m=i?.errors??[];s&&r.errorMap===s.errorMap||(m=Object.values(r.errorMap).reduce((t,e)=>(void 0===e||(e&&b(e)?t.push(e.form):t.push(e)),t),[]));let p=0===m.length,g=o&&p,S=this.options.canSubmitWhenInvalid??!1,M=0===r.submissionAttempts&&!l&&!v||!n&&!r.isSubmitting&&g||S,V=r.errorMap;if(h&&(m=m.filter(t=>t!==r.errorMap.onMount),V=Object.assign(V,{onMount:void 0})),i&&s&&i.errorMap===V&&i.fieldMeta===this.fieldMetaDerived.state&&i.errors===m&&i.isFieldsValidating===n&&i.isFieldsValid===o&&i.isFormValid===p&&i.isValid===g&&i.canSubmit===M&&i.isTouched===l&&i.isBlurred===u&&i.isPristine===f&&i.isDefaultValue===d&&i.isDirty===c&&y(s,r))return i;let E={...r,errorMap:V,fieldMeta:this.fieldMetaDerived.state,errors:m,isFieldsValidating:n,isFieldsValid:o,isFormValid:p,isValid:g,canSubmit:M,isTouched:l,isBlurred:u,isPristine:f,isDefaultValue:d,isDirty:c},A=this.options.transform?.deps??[];if(A.length!==this.prevTransformArray.length||A.some((t,e)=>t!==this.prevTransformArray[e])){let t=Object.assign({},this,{state:E});this.options.transform?.fn(t),E=t.state,this.prevTransformArray=A}return E}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(t||{});let e=new N(t=>Q.emit("form-state",{id:this._formId,state:t}),{wait:300}).maybeExecute;this.store.subscribe(()=>{e(this.store.state)}),Q.on("request-form-state",t=>{t.payload.id===this._formId&&Q.emit("form-api",{id:this._formId,state:this.store.state,options:this.options})}),Q.on("request-form-reset",t=>{t.payload.id===this._formId&&this.reset()}),Q.on("request-form-force-submit",t=>{t.payload.id===this._formId&&(this._devtoolsSubmissionOverride=!0,this.handleSubmit(),this._devtoolsSubmissionOverride=!1)})}get state(){return this.store.state}get formId(){return this._formId}runValidator(t){return z(t.validate)?q[t.type](t.value,t.validate):t.validate(t.value)}async handleSubmit(t){this.baseStore.setState(t=>({...t,isSubmitted:!1,submissionAttempts:t.submissionAttempts+1,isSubmitSuccessful:!1})),_(()=>{Object.values(this.fieldInfo).forEach(t=>{t.instance&&(t.instance.state.meta.isTouched||t.instance.setMeta(t=>({...t,isTouched:!0})))})});let e=t??this.options.onSubmitMeta;if(!this.state.canSubmit&&!this._devtoolsSubmissionOverride)return void this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e});this.baseStore.setState(t=>({...t,isSubmitting:!0}));let i=()=>{this.baseStore.setState(t=>({...t,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){i(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e}),Q.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validateAllFields",errors:Object.values(this.state.fieldMeta).map(t=>t.errors).flat()});return}if(await this.validate("submit"),!this.state.isValid){i(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e}),Q.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validate",errors:this.state.errors});return}_(()=>{Object.values(this.fieldInfo).forEach(t=>{t.instance?.options.listeners?.onSubmit?.({value:t.instance.state.value,fieldApi:t.instance})})}),this.options.listeners?.onSubmit?.({formApi:this,meta:e});try{await this.options.onSubmit?.({value:this.state.values,formApi:this,meta:e}),_(()=>{this.baseStore.setState(t=>({...t,isSubmitted:!0,isSubmitSuccessful:!0})),Q.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!0}),i()})}catch(t){throw this.baseStore.setState(t=>({...t,isSubmitSuccessful:!1})),Q.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"inflight",onError:t}),i(),t}}setErrorMap(t){_(()=>{Object.entries(t).forEach(([t,e])=>{if(b(e)){let{formError:i,fieldErrors:s}=Z(e);for(let e of Object.keys(this.fieldInfo))this.getFieldMeta(e)&&this.setFieldMeta(e,i=>({...i,errorMap:{...i.errorMap,[t]:s?.[e]},errorSourceMap:{...i.errorSourceMap,[t]:"form"}}));this.baseStore.setState(e=>({...e,errorMap:{...e.errorMap,[t]:i}}))}else this.baseStore.setState(i=>({...i,errorMap:{...i.errorMap,[t]:e}}))})})}}function Z(t){if(t)return b(t)?{formError:Z(t.form).formError,fieldErrors:t.fields}:{formError:t};return{formError:void 0}}function tt(t){switch(t){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";default:return"onChange"}}var te=i(2446);function ti(t,e=t=>t){return(0,te.useSyncExternalStoreWithSelector)(t.subscribe,()=>t.state,()=>t.state,e,ts)}function ts(t,e){if(Object.is(t,e))return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(let[i,s]of t)if(!e.has(i)||!Object.is(s,e.get(i)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(let i of t)if(!e.has(i))return!1;return!0}if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();let i=tr(t);if(i.length!==tr(e).length)return!1;for(let s=0;s<i.length;s++)if(!Object.prototype.hasOwnProperty.call(e,i[s])||!Object.is(t[i[s]],e[i[s]]))return!1;return!0}function tr(t){return Object.keys(t).concat(Object.getOwnPropertySymbols(t))}var ta=i(9769);class tn{constructor(t){this.options={},this.mount=()=>{let t=this.store.mount();void 0===this.options.defaultValue||this.getMeta().isTouched||this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0}),this.getInfo().instance=this,this.update(this.options);let{onMount:e}=this.options.validators||{};if(e){let t=this.runValidator({validate:e,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});t&&this.setMeta(e=>({...e,errorMap:{...e?.errorMap,onMount:t},errorSourceMap:{...e?.errorSourceMap,onMount:"field"}}))}return this.options.listeners?.onMount?.({value:this.state.value,fieldApi:this}),t},this.update=t=>{this.options=t,this.name=t.name,!this.state.meta.isTouched&&void 0!==this.options.defaultValue&&(y(this.form.getFieldValue(this.name),t.defaultValue)||this.form.setFieldValue(this.name,t.defaultValue,{dontUpdateMeta:!0,dontValidate:!0,dontRunListeners:!0})),this.form.getFieldMeta(this.name)||this.form.setFieldMeta(this.name,this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(t,e)=>{this.form.setFieldValue(this.name,t,V(e,{dontRunListeners:!0,dontValidate:!0})),e?.dontRunListeners||this.triggerOnChangeListener(),e?.dontValidate||this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=t=>this.form.setFieldMeta(this.name,t),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(t,e)=>{this.form.pushFieldValue(this.name,t,V(e,{dontRunListeners:!0})),e?.dontRunListeners||this.triggerOnChangeListener()},this.insertValue=(t,e,i)=>{this.form.insertFieldValue(this.name,t,e,V(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.replaceValue=(t,e,i)=>{this.form.replaceFieldValue(this.name,t,e,V(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.removeValue=(t,e)=>{this.form.removeFieldValue(this.name,t,V(e,{dontRunListeners:!0})),e?.dontRunListeners||this.triggerOnChangeListener()},this.swapValues=(t,e,i)=>{this.form.swapFieldValues(this.name,t,e,V(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.moveValue=(t,e,i)=>{this.form.moveFieldValues(this.name,t,e,V(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.clearValues=t=>{this.form.clearFieldValues(this.name,V(t,{dontRunListeners:!0})),t?.dontRunListeners||this.triggerOnChangeListener()},this.getLinkedFields=t=>{let e=Object.values(this.form.fieldInfo),i=[];for(let s of e){if(!s.instance)continue;let{onChangeListenTo:e,onBlurListenTo:r}=s.instance.options.validators||{};"change"===t&&e?.includes(this.name)&&i.push(s.instance),"blur"===t&&r?.includes(this.name)&&i.push(s.instance)}return i},this.validateSync=(t,e)=>{let i=p(t,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||U}),s=this.getLinkedFields(t).reduce((e,i)=>{let s=p(t,{...i.options,form:i.form,validationLogic:i.form.options.validationLogic||U});return s.forEach(t=>{t.field=i}),e.concat(s)},[]),r=!1;_(()=>{let t=(t,i)=>{let s=tl(i.cause),a=i.validate?to(t.runValidator({validate:i.validate,value:{value:t.store.state.value,validationSource:"field",fieldApi:t},type:"validate"})):void 0,{newErrorValue:n,newSource:o}=M({formLevelError:e[s],fieldLevelError:a});t.state.meta.errorMap?.[s]!==n&&t.setMeta(t=>({...t,errorMap:{...t.errorMap,[s]:n},errorSourceMap:{...t.errorSourceMap,[s]:o}})),n&&(r=!0)};for(let e of i)t(this,e);for(let e of s)e.validate&&t(e.field,e)});let a=tl("submit");return this.state.meta.errorMap?.[a]&&"submit"!==t&&!r&&this.setMeta(t=>({...t,errorMap:{...t.errorMap,[a]:void 0},errorSourceMap:{...t.errorSourceMap,[a]:void 0}})),{hasErrored:r}},this.validateAsync=async(t,e)=>{let i=g(t,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||U}),s=await e,r=this.getLinkedFields(t),a=r.reduce((e,i)=>{let s=g(t,{...i.options,form:i.form,validationLogic:i.form.options.validationLogic||U});return s.forEach(t=>{t.field=i}),e.concat(s)},[]);for(let t of(this.state.meta.isValidating||this.setMeta(t=>({...t,isValidating:!0})),r))t.setMeta(t=>({...t,isValidating:!0}));let n=[],o=[],l=(t,e,i)=>{let r=tl(e.cause),a=t.getInfo().validationMetaMap[r];a?.lastAbortController.abort();let n=new AbortController;this.getInfo().validationMetaMap[r]={lastAbortController:n},i.push(new Promise(async i=>{let a;try{a=await new Promise((i,s)=>{this.timeoutIds.validations[e.cause]&&clearTimeout(this.timeoutIds.validations[e.cause]),this.timeoutIds.validations[e.cause]=setTimeout(async()=>{if(n.signal.aborted)return i(void 0);try{i(await this.runValidator({validate:e.validate,value:{value:t.store.state.value,fieldApi:t,signal:n.signal,validationSource:"field"},type:"validateAsync"}))}catch(t){s(t)}},e.debounceMs)})}catch(t){a=t}if(n.signal.aborted)return i(void 0);let o=to(a),{newErrorValue:l,newSource:u}=M({formLevelError:s[this.name]?.[r],fieldLevelError:o});t.setMeta(t=>({...t,errorMap:{...t?.errorMap,[r]:l},errorSourceMap:{...t.errorSourceMap,[r]:u}})),i(l)}))};for(let t of i)t.validate&&l(this,t,n);for(let t of a)t.validate&&l(t.field,t,o);let u=[];for(let t of((n.length||o.length)&&(u=await Promise.all(n),await Promise.all(o)),this.setMeta(t=>({...t,isValidating:!1})),r))t.setMeta(t=>({...t,isValidating:!1}));return u.filter(Boolean)},this.validate=(t,e)=>{if(!this.state.meta.isTouched)return[];let{fieldsErrorMap:i}=e?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(t),{hasErrored:s}=this.validateSync(t,i[this.name]??{});if(s&&!this.options.asyncAlways)return this.getInfo().validationMetaMap[tl(t)]?.lastAbortController.abort(),this.state.meta.errors;let r=e?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(t);return this.validateAsync(t,r)},this.handleChange=t=>{this.setValue(t)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(t=>({...t,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(t=>({...t,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=t=>q.validate({value:this.state.value,validationSource:"field"},t),this.parseValueWithSchemaAsync=t=>q.validateAsync({value:this.state.value,validationSource:"field"},t),this.form=t.form,this.name=t.name,this.options=t,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new w({deps:[this.form.store],fn:()=>{let e=this.form.getFieldMeta(this.name)??{...K,...t.defaultMeta},i=this.form.getFieldValue(this.name);return e.isTouched||void 0!==i||void 0===this.options.defaultValue||y(i,this.options.defaultValue)||(i=this.options.defaultValue),{value:i,meta:e}}})}get state(){return this.store.state}runValidator(t){return z(t.validate)?q[t.type](t.value,t.validate):t.validate(t.value)}setErrorMap(t){this.setMeta(e=>({...e,errorMap:{...e.errorMap,...t}}))}triggerOnBlurListener(){let t=this.form.options.listeners?.onBlurDebounceMs;t&&t>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this})},t)):this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this});let e=this.options.listeners?.onBlurDebounceMs;e&&e>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})},e)):this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})}triggerOnChangeListener(){let t=this.form.options.listeners?.onChangeDebounceMs;t&&t>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this})},t)):this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this});let e=this.options.listeners?.onChangeDebounceMs;e&&e>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})},e)):this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})}}function to(t){if(t)return t}function tl(t){switch(t){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";default:return"onChange"}}let tu="undefined"!=typeof window?ta.useLayoutEffect:ta.useEffect,td=t=>{let{children:e,...i}=t,s=function(t){let e=(0,ta.useRef)(t);e.current=t;let i=(0,ta.useMemo)(()=>{let i=new tn({...e.current,form:t.form,name:t.name});return i.Field=td,i},[t.form,t.name]);return tu(i.mount,[i]),tu(()=>{i.update(t)}),ti(i.store,"array"===t.mode?t=>{var e;return[t.meta,Object.keys(null!=(e=t.value)?e:[]).length]}:void 0),i}(i),n=(0,ta.useMemo)(()=>a(e,s),[e,s,s.state.value,s.state.meta]);return(0,r.jsx)(r.Fragment,{children:n})};function th(t){let{form:e,selector:i,children:s}=t;return a(s,ti(e.store,i))}function tc(t){let e=(0,ta.useId)(),[i]=(0,ta.useState)(()=>{let i=new Y({...t,formId:e});return i.Field=function(t){return(0,r.jsx)(td,{...t,form:i})},i.Subscribe=function(t){return(0,r.jsx)(th,{form:i,selector:t.selector,children:t.children})},i});return tu(i.mount,[]),tu(()=>{i.update(t)}),i}}}]);